extends layout

block content
  section.admin-shell
    .admin-header
      h1.admin-title Admin Dashboard
      p.admin-subtitle Manage content and platform operations from one workspace.

    .admin-manage-grid
      .admin-card
        .admin-card-head
          h3.admin-card-title Admin
          a.btn.admin-btn(href="/signup/admin") Add Admin
        p#adminFeedback.admin-feedback.d-none
        ul#adminList.admin-item-list
          li.text-muted Loading admins...

      .admin-card
        .admin-card-head
          h3.admin-card-title Questions
          button#answerQuestionsBtn.btn.admin-btn(type="button" data-no-loading)
            | Answer Questions
            span#answerQuestionsCount.badge.text-bg-danger.ms-2.d-none 0
        p#questionFeedback.admin-feedback.d-none
        ul#questionList.admin-item-list
          li.text-muted Loading questions...

      .admin-card
        .admin-card-head
          h3.admin-card-title Articles
          a.btn.admin-btn(href="/create_article") Add Article
        p.admin-card-note Draft articles stay private until published.
        p#articleFeedback.admin-feedback.d-none
        ul#articleList.admin-item-list
          li.text-muted Loading articles...

      .admin-card
        .admin-card-head
          h3.admin-card-title Class
          button.btn.admin-btn(type="button" data-bs-toggle="modal" data-bs-target="#classSessionModal") Add Session
        .d-flex.flex-wrap.justify-content-end.gap-2.mb-2
          a.btn.admin-btn(href="/registrations/pending") Approve Registrations
        h4.admin-card-title.mb-2 Home Page Live Video
        .d-flex.gap-2.mb-2
          button.btn.btn-outline-primary(type="button" data-bs-toggle="modal" data-bs-target="#liveStreamScheduleModal") Set Countdown
          button#clearLiveStreamScheduleBtn.btn.btn-outline-secondary(type="button" data-no-loading) Clear
        p#liveStreamScheduleStatus.admin-card-note No incoming live video for the moment.
        hr.my-3
        h4.admin-card-title.mb-2 Live Class
        p#liveClassStatus.admin-card-note Live class is currently not active.
        .d-flex.gap-2.mb-2
          button#endLiveClassBtn.btn.btn-outline-danger(type="button" data-no-loading) End Live Class
          button#joinLiveClassBtn.btn.btn-outline-success(type="button" data-no-loading disabled) Enter Live Class
        p#classFeedback.admin-feedback.d-none
        ul#classList.admin-item-list
          li.text-muted Loading class sessions...

      .admin-card
        .admin-card-head
          h3.admin-card-title Categories
          button.btn.admin-btn(type="button" data-bs-toggle="modal" data-bs-target="#categoryModal") Add Category
        p.admin-card-note Manage video categories and remove outdated groups.
        p#categoryFeedback.admin-feedback.d-none
        ul#categoryList.admin-item-list
          li.text-muted Loading categories...

      .admin-card
        .admin-card-head
          h3.admin-card-title Videos
          button.btn.admin-btn(type="button" data-bs-toggle="modal" data-bs-target="#videoModal") Add Video
        .admin-filter-row
          label.form-label(for="videoCategoryFilter") Filter by category
          select#videoCategoryFilter.form-select
            option(value="") All categories
        p#videoFeedback.admin-feedback.d-none
        ul#videoList.admin-item-list
          li.text-muted Loading videos...

  .modal.fade#categoryModal(tabindex="-1" aria-labelledby="categoryModalLabel" aria-hidden="true")
    .modal-dialog
      .modal-content
        .modal-header
          h5#categoryModalLabel.modal-title Add Category
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        form#categoryForm
          .modal-body
            .mb-3
              label.form-label(for="categoryTitle") Category Title
              input#categoryTitle.form-control(type="text" name="title" placeholder="e.g. Quran Reflections" required)
            p#categoryModalFeedback.admin-feedback.d-none
          .modal-footer
            button.btn.btn-outline-secondary(type="button" data-bs-dismiss="modal") Cancel
            button.btn.admin-btn(type="submit") Save Category

  .modal.fade#categoryEditModal(tabindex="-1" aria-labelledby="categoryEditModalLabel" aria-hidden="true")
    .modal-dialog
      .modal-content
        .modal-header
          h5#categoryEditModalLabel.modal-title Edit Category
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        form#categoryEditForm
          input#categoryEditId(type="hidden" name="categoryId")
          .modal-body
            .mb-3
              label.form-label(for="categoryEditTitle") Category Title
              input#categoryEditTitle.form-control(type="text" name="title" required)
            p#categoryEditModalFeedback.admin-feedback.d-none
          .modal-footer
            button.btn.btn-outline-secondary(type="button" data-bs-dismiss="modal") Cancel
            button.btn.admin-btn(type="submit") Save Changes

  .modal.fade#videoModal(tabindex="-1" aria-labelledby="videoModalLabel" aria-hidden="true")
    .modal-dialog
      .modal-content
        .modal-header
          h5#videoModalLabel.modal-title Add Video
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        form#videoForm
          .modal-body
            .mb-3
              label.form-label(for="videoTitle") Video Title
              input#videoTitle.form-control(type="text" name="title" required)
            .mb-3
              label.form-label(for="videoCategory") Category
              select#videoCategory.form-select(name="category" required)
                option(value="") Select category
            .mb-3
              label.form-label(for="youtubeUrl") YouTube URL
              input#youtubeUrl.form-control(type="url" name="youtubeUrl" placeholder="https://youtube.com/watch?v=..." required)
            p#videoModalFeedback.admin-feedback.d-none
          .modal-footer
            button.btn.btn-outline-secondary(type="button" data-bs-dismiss="modal") Cancel
            button.btn.admin-btn(type="submit") Save Video

  .modal.fade#videoPreviewModal(tabindex="-1" aria-labelledby="videoPreviewModalLabel" aria-hidden="true")
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5#videoPreviewModalLabel.modal-title Video Preview
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        .modal-body
          h6#videoPreviewTitle.mb-3
          .iframe-container
            iframe#videoPreviewFrame(
              src=""
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            )

  .modal.fade#classSessionModal(tabindex="-1" aria-labelledby="classSessionModalLabel" aria-hidden="true")
    .modal-dialog
      .modal-content
        .modal-header
          h5#classSessionModalLabel.modal-title Add Session
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        form#classSessionForm
          .modal-body
            .mb-3
              label.form-label(for="classSessionTitle") Session Title
              input#classSessionTitle.form-control(type="text" name="title" required)
            .mb-3
              label.form-label(for="classSessionPrice") Session Price (GHC)
              input#classSessionPrice.form-control(type="number" name="price" min="0" step="0.01" placeholder="e.g. 50" required)
            .mb-3
              label.form-label(for="classSessionAccessDurationDays") Access Duration (Days)
              input#classSessionAccessDurationDays.form-control(type="number" name="accessDurationDays" min="1" max="3650" step="1" value="30" required)
            .mb-3
              label.form-label(for="classSessionStartDate") First Session Date
              input#classSessionStartDate.form-control(type="date" name="scheduleStartDate" required)
            .mb-3
              label.form-label(for="classSessionStartTime") Session Start Time
              input#classSessionStartTime.form-control(type="time" name="scheduleStartTime" required)
            .mb-3
              label.form-label(for="classSessionDurationMinutes") Session Duration (Minutes)
              input#classSessionDurationMinutes.form-control(type="number" name="durationMinutes" min="15" max="720" step="5" value="60" required)
            .mb-3
              label.form-label(for="classSessionFrequency") Frequency
              select#classSessionFrequency.form-select(name="frequency" required)
                option(value="weekly" selected) Weekly
                option(value="daily") Every day
            .mb-3#classSessionWeekDaysGroup
              label.form-label Week days (for weekly sessions)
              .d-flex.flex-wrap.gap-2
                each dayLabel, dayValue in ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']
                  .form-check
                    input.form-check-input(
                      id=`classSessionWeekDay${dayValue}`
                      type="checkbox"
                      name="weekDays"
                      value=dayValue
                      checked=dayValue === 1
                    )
                    label.form-check-label(for=`classSessionWeekDay${dayValue}`)= dayLabel
            p#classSessionModalFeedback.admin-feedback.d-none
          .modal-footer
            button.btn.btn-outline-secondary(type="button" data-bs-dismiss="modal") Cancel
            button.btn.admin-btn(type="submit") Save Session

  .modal.fade#classSessionEditModal(tabindex="-1" aria-labelledby="classSessionEditModalLabel" aria-hidden="true")
    .modal-dialog
      .modal-content
        .modal-header
          h5#classSessionEditModalLabel.modal-title Edit Session
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        form#classSessionEditForm
          input#classSessionEditId(type="hidden" name="sessionId")
          .modal-body
            .mb-3
              label.form-label(for="classSessionEditTitle") Session Title
              input#classSessionEditTitle.form-control(type="text" name="title" required)
            .mb-3
              label.form-label(for="classSessionEditPrice") Session Price (GHC)
              input#classSessionEditPrice.form-control(type="number" name="price" min="0" step="0.01" required)
            .mb-3
              label.form-label(for="classSessionEditAccessDurationDays") Access Duration (Days)
              input#classSessionEditAccessDurationDays.form-control(type="number" name="accessDurationDays" min="1" max="3650" step="1" required)
            .mb-3
              label.form-label(for="classSessionEditStartDate") First Session Date
              input#classSessionEditStartDate.form-control(type="date" name="scheduleStartDate" required)
            .mb-3
              label.form-label(for="classSessionEditStartTime") Session Start Time
              input#classSessionEditStartTime.form-control(type="time" name="scheduleStartTime" required)
            .mb-3
              label.form-label(for="classSessionEditDurationMinutes") Session Duration (Minutes)
              input#classSessionEditDurationMinutes.form-control(type="number" name="durationMinutes" min="15" max="720" step="5" required)
            .mb-3
              label.form-label(for="classSessionEditFrequency") Frequency
              select#classSessionEditFrequency.form-select(name="frequency" required)
                option(value="weekly") Weekly
                option(value="daily") Every day
            .mb-3#classSessionEditWeekDaysGroup
              label.form-label Week days (for weekly sessions)
              .d-flex.flex-wrap.gap-2
                each dayLabel, dayValue in ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']
                  .form-check
                    input.form-check-input(
                      id=`classSessionEditWeekDay${dayValue}`
                      type="checkbox"
                      name="weekDays"
                      value=dayValue
                    )
                    label.form-check-label(for=`classSessionEditWeekDay${dayValue}`)= dayLabel
            p#classSessionEditModalFeedback.admin-feedback.d-none
          .modal-footer
            button.btn.btn-outline-secondary(type="button" data-bs-dismiss="modal") Cancel
            button.btn.admin-btn(type="submit") Save Changes

  .modal.fade#liveStreamScheduleModal(tabindex="-1" aria-labelledby="liveStreamScheduleModalLabel" aria-hidden="true")
    .modal-dialog
      .modal-content
        .modal-header
          h5#liveStreamScheduleModalLabel.modal-title Set Live Stream Countdown
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        form#liveStreamScheduleForm
          .modal-body
            .mb-3
              label.form-label(for="liveStreamStartsAt") Start Date & Time
              input#liveStreamStartsAt.form-control(type="datetime-local" name="startsAt" required)
            .mb-3
              label.form-label(for="liveStreamNote") Short Description
              input#liveStreamNote.form-control(type="text" name="note" maxlength="220" placeholder="e.g. Tafsir session on Surah Al-Mulk")
              .form-text Displayed on home page along with countdown.
            p#liveStreamScheduleModalFeedback.admin-feedback.d-none
          .modal-footer
            button.btn.btn-outline-secondary(type="button" data-bs-dismiss="modal") Cancel
            button.btn.admin-btn(type="submit") Save Countdown

  .modal.fade#questionAnswerModal(tabindex="-1" aria-labelledby="questionAnswerModalLabel" aria-hidden="true")
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5#questionAnswerModalLabel.modal-title Edit Answer
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        form#questionAnswerForm
          input#questionAnswerId(type="hidden" name="questionId")
          .modal-body
            .mb-3
              label.form-label(for="questionAnswerSelect") Pending Questions
              select#questionAnswerSelect.form-select
              small#questionAnswerSelectHint.text-muted
            .mb-3
              label.form-label(for="questionAnswerText") Question
              textarea#questionAnswerText.form-control(rows="3" readonly)
            .mb-3
              label.form-label(for="questionAnswerInput") Answer
              textarea#questionAnswerInput.form-control(name="answer" rows="8" required)
            p#questionAnswerModalFeedback.admin-feedback.d-none
          .modal-footer
            button.btn.btn-outline-secondary(type="button" data-bs-dismiss="modal") Cancel
            button.btn.admin-btn(type="submit") Save Answer

  .modal.fade#classSessionUsersModal(tabindex="-1" aria-labelledby="classSessionUsersModalLabel" aria-hidden="true")
    .modal-dialog.modal-lg
      .modal-content
        .modal-header
          h5#classSessionUsersModalLabel.modal-title Session Users
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        .modal-body
          p#classSessionUsersTitle.fw-bold.mb-3
          ul#classSessionUsersList.admin-item-list
            li.text-muted Loading users...

  .modal.fade#deleteConfirmModal(tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true")
    .modal-dialog
      .modal-content
        .modal-header
          h5#deleteConfirmModalLabel.modal-title Confirm Delete
          button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
        .modal-body
          p#deleteConfirmMessage.mb-0 Are you sure you want to delete this item?
        .modal-footer
          button.btn.btn-outline-secondary(type="button" data-bs-dismiss="modal") Cancel
          button#deleteConfirmButton.btn.btn-danger(type="button") Delete

block scripts
  script(src="/javascripts/adminDashboard.js")
