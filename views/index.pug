extends layout

block content
  section.home-hero
    .hero-content
      h1.hero-title At-Taqwa Foundation
      p.hero-subtitle The gateway to taqwa through live teaching, practical resources, and trusted answers.
      .hero-actions
        a.btn.btn-donate(href="/donate") Donate Now

  section.home-grid
    .row.g-4
      .col-12.col-lg-8
        .panel.live-panel
          .panel-header
            h2 Live Stream
            p#liveStreamNote.live-stream-note(
              data-note=(liveStreamSchedule && liveStreamSchedule.note ? liveStreamSchedule.note : '')
            )
          p#liveStreamCountdown.countdown-text(
            data-start-at=(liveStreamSchedule && liveStreamSchedule.startsAt ? liveStreamSchedule.startsAt.toISOString() : '')
          ) No incoming live video for the moment
          .iframe-container
            iframe(
              src=liveVideoUrl
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
              title="Live stream player"
            )

      .col-12.col-lg-4
        .panel.ask-panel
          a.btn.btn-live-class(href="/live_class")
            i.fas.fa-broadcast-tower.me-2
            | Join Live Class
          .ask-brand
            img.sheesu(src="/images/sheesu.jpg" alt="Sheesu")
            a.btn.btn-ask(href="/ask_sheesu") Ask Shiisu
          h3.panel-section-title Recent Questions and Answers
          ul.question-list.list.home-lazy-list(
            data-feed-type="questions"
            data-page-size=homePageSize
            data-initial-count=questions.length
            data-has-more=hasMoreQuestions
          )
            if questions.length
              each question in questions
                li
                  a(href=`/question/${question._id}`) #{question.question}
            else
              li.text-muted.home-empty-state No answered questions yet.
            li.home-list-loader.text-muted(style="display:none;") Loading...
            li.home-list-sentinel(aria-hidden="true")

    .row.g-4.mt-1
      .col-12.col-lg-6
        .panel.resources-panel
          h3.panel-section-title Videos
          ul.video-list.list.home-lazy-list(
            data-feed-type="videos"
            data-page-size=homePageSize
            data-initial-count=videoCategories.length
            data-has-more=hasMoreVideos
          )
            if videoCategories.length
              each category in videoCategories
                li
                  a(href=category.url) #{category.title}
            else
              li.text-muted.home-empty-state No video categories available.
            li.home-list-loader.text-muted(style="display:none;") Loading...
            li.home-list-sentinel(aria-hidden="true")

      .col-12.col-lg-6
        .panel.resources-panel
          h3.panel-section-title Articles and Curricular
          ul.article-list.list.home-lazy-list(
            data-feed-type="articles"
            data-page-size=homePageSize
            data-initial-count=articles.length
            data-has-more=hasMoreArticles
          )
            if articles.length
              each article in articles
                li
                  a(href=`/article/${article._id}`) #{article.title}
            else
              li.text-muted.home-empty-state No articles available.
            li.home-list-loader.text-muted(style="display:none;") Loading...
            li.home-list-sentinel(aria-hidden="true")

    .row.mt-4
      .col-12
        .visitors-bottom
          span Visitors
          strong= visitorCount

  if liveClassNotice
    .modal.fade#liveClassNoticeModal(tabindex="-1" aria-labelledby="liveClassNoticeModalLabel" aria-hidden="true")
      .modal-dialog
        .modal-content
          .modal-header
            h5#liveClassNoticeModalLabel.modal-title Live Class Notice
            button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
          .modal-body
            p.mb-0= liveClassNotice
          .modal-footer
            button.btn.admin-btn(type="button" data-bs-dismiss="modal") Okay

block scripts
  script(src="/javascripts/homeLazyLists.js")
  script(src="/javascripts/homeCountdown.js")
  if liveClassNotice
    script.
      (function () {
        const showNoticeModal = function () {
          const modalElement = document.getElementById('liveClassNoticeModal');
          if (!modalElement) {
            return;
          }

          if (window.bootstrap && window.bootstrap.Modal) {
            const noticeModal = window.bootstrap.Modal.getOrCreateInstance(modalElement);
            noticeModal.show();
            return;
          }

          window.alert("#{liveClassNotice}");
        };

        if (document.readyState === 'complete') {
          showNoticeModal();
          return;
        }

        window.addEventListener('load', showNoticeModal, { once: true });
      })();
