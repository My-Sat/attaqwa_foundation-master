extends layout

block content
  section.auth-shell
    .auth-card
      .auth-header
        h1.auth-title Forgot Password
        p.auth-subtitle Request an SMS code, verify it, then set a new password.

      if success && success.length
        each msg in success
          .alert.alert-success.auth-alert(role="alert")= msg

      if error && error.length
        each msg in error
          .alert.alert-danger.auth-alert(role="alert")= msg

      if step === 'verify'
        form#passwordSettingsForm.auth-form(method="POST" action="/forgot_password/verify")
          input(type="hidden" name="requestId" value=(requestId || ''))
          .row.g-3
            .col-12
              label.form-label(for="phoneNumber") Phone Number
              input#phoneNumber.form-control.auth-input(type="tel" name="phoneNumber" value=(oldInput && oldInput.phoneNumber ? oldInput.phoneNumber : '') autocomplete="tel" placeholder="Add country code, e.g. +233" required)
            .col-12
              label.form-label(for="verificationCode") Verification Code
              input#verificationCode.form-control.auth-input(type="text" name="verificationCode" inputmode="numeric" maxlength="6" placeholder="6-digit code" required)
            .col-12
              label.form-label(for="newPassword") New Password
              .password-field
                input#newPassword.form-control.auth-input(type="password" name="newPassword" minlength="8" autocomplete="new-password" required)
                button.password-toggle-btn(type="button" data-toggle-target="newPassword" aria-label="Show new password")
                  i.fas.fa-eye(aria-hidden="true")
            .col-12
              label.form-label(for="confirmNewPassword") Confirm New Password
              .password-field
                input#confirmNewPassword.form-control.auth-input(type="password" name="confirmNewPassword" minlength="8" autocomplete="new-password" required)
                button.password-toggle-btn(type="button" data-toggle-target="confirmNewPassword" aria-label="Show confirmed password")
                  i.fas.fa-eye(aria-hidden="true")
              small#passwordSettingsMatch.password-match-indicator.text-muted.mt-2 Type to confirm password.
          button.btn.auth-submit.mt-3(type="submit") Reset Password
      else
        form.auth-form(method="POST" action="/forgot_password/request")
          .row.g-3
            .col-12
              label.form-label(for="phoneNumber") Phone Number
              input#phoneNumber.form-control.auth-input(type="tel" name="phoneNumber" value=(oldInput && oldInput.phoneNumber ? oldInput.phoneNumber : '') autocomplete="tel" placeholder="Add country code, e.g. +233" required)
          button.btn.auth-submit.mt-3(type="submit") Send Verification Code

      p.auth-footer.mb-0
        a(href="/signin") Back to Sign in

block scripts
  if step === 'verify'
    script(src="/javascripts/passwordSettings.js")
