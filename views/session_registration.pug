extends layout

block content
  section.auth-shell
    .auth-card
      style.
        .payment-guide {
          border: 1px solid #d9e8ff;
          border-radius: 14px;
          background: linear-gradient(135deg, #f6faff 0%, #ffffff 100%);
          padding: 1rem;
          margin-bottom: 1rem;
        }
        .payment-guide-title {
          color: #0f3c78;
          font-weight: 700;
          margin-bottom: .35rem;
        }
        .payment-guide-subtitle {
          color: #5d6b7b;
          font-size: .95rem;
          margin-bottom: .85rem;
        }
        .payment-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
          gap: .75rem;
        }
        .payment-block {
          border: 1px solid #e6eef8;
          border-radius: 12px;
          background: #ffffff;
          padding: .8rem;
        }
        .payment-block h6 {
          margin: 0 0 .5rem;
          color: #0f3c78;
          font-weight: 700;
        }
        .payment-line {
          margin-bottom: .25rem;
          color: #2f3b4a;
          font-size: .94rem;
        }
        .payment-line:last-child {
          margin-bottom: 0;
        }
        .payment-line strong {
          color: #0f7a3d;
        }

      .auth-header
        h1.auth-title= title
        p.auth-subtitle Submit your payment proof and wait for admin approval.

      if success && success.length > 0
        .alert.alert-success.auth-alert
          each msg in success
            p.mb-0= msg

      if error && error.length > 0
        .alert.alert-danger.auth-alert
          each msg in error
            p.mb-0= msg

      p.auth-subtitle
        | Each session has its own price. Select a session to view the exact amount and schedule.

      form(action='/register' method='POST')
        .mb-3
          label.form-label(for='sessionId') Select Class Session
          select#sessionId.form-select(name='sessionId' required)
            option(value='') Select a session
            each session in classSessions
              option(
                value=session._id
                data-price=(typeof session.price === 'number' ? session.price.toFixed(2) : '0.00')
                data-schedule=session.scheduleSummary
                data-access-duration-days=(typeof session.accessDurationDays === 'number' ? session.accessDurationDays : 30)
                selected=formData && formData.sessionId && String(formData.sessionId) === String(session._id)
              )= session.title
        .mb-3
          .alert.alert-info.py-2.px-3.mb-0#sessionDetailsPanel
            strong.d-block#selectedSessionPrice Select a session to see price.
            small.text-muted#selectedSessionSchedule Schedule details will appear here.
            small.text-muted.d-block#selectedSessionAccessDuration Access duration details will appear here.
        .payment-guide
          h5.payment-guide-title Payment Details
          p.payment-guide-subtitle
            | Use any of the options below to make payment, then submit your payment proof/reference.
          .payment-grid
            .payment-block
              h6 Mobile Money
              p.payment-line
                | Number:
                strong  +233591459200
              p.payment-line
                | Name:
                strong  At-taqwafoundation and Humanitarian Service
            .payment-block
              h6 Bank Transfer
              p.payment-line
                | Bank:
                strong  Absa
              p.payment-line
                | Branch:
                strong  Tamale
              p.payment-line
                | Acc Name:
                strong  At-Taqwa foundation and Humanitrian
              p.payment-line
                | Acc Number:
                strong  033-1809918
        .mb-3
          label.form-label(for='paymentMethod') Payment Method
          select#paymentMethod.form-select(name='paymentMethod' required)
            option(value='MoMo' selected=formData && formData.paymentMethod === 'MoMo') MoMo
            option(value='Bank Transfer' selected=formData && formData.paymentMethod === 'Bank Transfer') Bank Transfer
            option(value='Card' selected=formData && formData.paymentMethod === 'Card') Card
            option(value='Other' selected=!formData || !formData.paymentMethod || formData.paymentMethod === 'Other') Other
        .mb-3
          label.form-label(for='paymentReference') Payment Proof / Reference
          input#paymentReference.auth-input.form-control(
            type='text'
            name='paymentReference'
            value=formData && formData.paymentReference ? formData.paymentReference : ''
            placeholder='e.g. transaction ID, bank receipt number, sender name'
            required
          )
        button.btn.auth-submit(type='submit') Register

  if liveClassNotice
    .modal.fade#sessionAccessNoticeModal(tabindex="-1" aria-labelledby="sessionAccessNoticeModalLabel" aria-hidden="true")
      .modal-dialog
        .modal-content
          .modal-header
            h5#sessionAccessNoticeModalLabel.modal-title Live Class Access Notice
            button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
          .modal-body
            p.mb-0= liveClassNotice
          .modal-footer
            button.btn.admin-btn(type="button" data-bs-dismiss="modal") Okay

block scripts
  script.
    (function () {
      const sessionSelect = document.getElementById('sessionId');
      const priceElement = document.getElementById('selectedSessionPrice');
      const scheduleElement = document.getElementById('selectedSessionSchedule');
      const accessDurationElement = document.getElementById('selectedSessionAccessDuration');

      if (!sessionSelect || !priceElement || !scheduleElement || !accessDurationElement) {
        return;
      }

      const updateSessionDetails = function () {
        const selectedOption = sessionSelect.options[sessionSelect.selectedIndex];
        const price = selectedOption ? selectedOption.dataset.price : '';
        const schedule = selectedOption ? selectedOption.dataset.schedule : '';
        const accessDurationDays = selectedOption ? selectedOption.dataset.accessDurationDays : '';

        if (!selectedOption || !selectedOption.value) {
          priceElement.textContent = 'Select a session to see price.';
          scheduleElement.textContent = 'Schedule details will appear here.';
          accessDurationElement.textContent = 'Access duration details will appear here.';
          return;
        }

        priceElement.textContent = `Price: GHC ${price || '0.00'}`;
        scheduleElement.textContent = schedule || 'Schedule details unavailable.';
        accessDurationElement.textContent = `Access duration: ${accessDurationDays || '30'} day(s)`;
      };

      sessionSelect.addEventListener('change', updateSessionDetails);
      updateSessionDetails();
    })();

  if liveClassNotice
    script.
      (function () {
        const showNoticeModal = function () {
          const modalElement = document.getElementById('sessionAccessNoticeModal');
          if (!modalElement) {
            return;
          }

          if (window.bootstrap && window.bootstrap.Modal) {
            const noticeModal = window.bootstrap.Modal.getOrCreateInstance(modalElement);
            noticeModal.show();
            return;
          }

          window.alert("#{liveClassNotice}");
        };

        if (document.readyState === 'complete') {
          showNoticeModal();
          return;
        }

        window.addEventListener('load', showNoticeModal, { once: true });
      })();
